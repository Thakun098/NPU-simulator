# NPU Simulator ‚Äî ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° "2√ó2 Matrix Multiply")

‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î Matrix 2 ‡∏ï‡∏±‡∏ß (‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô 4√ó4 ‡πÇ‡∏î‡∏¢‡πÄ‡∏ï‡∏¥‡∏° 0):

```
Matrix A (DRAM[0..15])          Matrix B (DRAM[16..31])
| 1  2  0  0 |                  | 5  6  0  0 |
| 3  4  0  0 |                  | 7  8  0  0 |
| 0  0  0  0 |                  | 0  0  0  0 |
| 0  0  0  0 |                  | 0  0  0  0 |
```

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠ **C = A √ó B**:

```
| 1√ó5 + 2√ó7    1√ó6 + 2√ó8 |     | 19  22 |
| 3√ó5 + 4√ó7    3√ó6 + 4√ó8 |  =  | 43  50 |
```

---

## Cycle-by-Cycle Breakdown

### Cycle 0 ‚Äî `LOAD` (‡πÇ‡∏´‡∏•‡∏î Matrix A ‡πÄ‡∏Ç‡πâ‡∏≤ Buffer)

- **‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£**: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DRAM[0..15] ‚Üí SRAM[0..15]
- **‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï**:
  - ‡∏ä‡πà‡∏≠‡∏á DRAM ‡∏ó‡∏µ‡πà 0‚Äì15 ‡∏à‡∏∞ **highlight ‡∏™‡∏µ‡∏ü‡πâ‡∏≤** (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô)
  - ‡∏ä‡πà‡∏≠‡∏á SRAM ‡∏ó‡∏µ‡πà 0‚Äì15 ‡∏à‡∏∞ **highlight ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á** (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô)
- **Log**: `LOAD DRAM[0..15] ‚Üí SRAM[0..15]`

---

### Cycle 1 ‚Äî `LOAD` (‡πÇ‡∏´‡∏•‡∏î Matrix B ‡πÄ‡∏Ç‡πâ‡∏≤ Buffer)

- **‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£**: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DRAM[16..31] ‚Üí SRAM[16..31]
- **‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï**: highlight ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á 16‚Äì31
- **Log**: `LOAD DRAM[16..31] ‚Üí SRAM[16..31]`

---

### Cycle 2‚Äì8 ‚Äî `GEMM` (Matrix Multiply ‡πÅ‡∏ö‡∏ö Wavefront, 7 Cycles)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! GEMM ‡πÉ‡∏ä‡πâ **7 cycles** (2√ó4 - 1 = 7) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Systolic Array ‡πÅ‡∏ö‡∏ö **Wavefront** (‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÄ‡∏â‡∏µ‡∏¢‡∏á)

#### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞ Cycle

| Cycle |  t  | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢ (Matrix A)                 | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ö‡∏ô (Matrix B)                   | PE ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà |
| :---: | :-: | -------------------------------------- | -------------------------------------- | ---------------------- |
|   2   |  0  | Row0: A[0,0]=**1**                     | Col0: B[0,0]=**5**                     | PE(0,0)                |
|   3   |  1  | Row0: A[0,1]=**2**, Row1: A[1,0]=**3** | Col0: B[1,0]=**7**, Col1: B[0,1]=**6** | PE(0,1), PE(1,0)       |
|   4   |  2  | Row1: A[1,1]=**4**                     | Col1: B[1,1]=**8**                     | PE(1,1), PE(0,2), PE(2,0) |
|  5‚Äì8  | 3‚Äì6 | (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0)                    | (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0)                    | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏´‡∏•‡∏ú‡πà‡∏≤‡∏ô‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö       |

#### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô PE ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß (MAC = Multiply + Accumulate)

```
PE(0,0):  0 + 1√ó5 = 5   ‚Üí  5 + 2√ó7 = 19   ‚úÖ  (= A row 0 ¬∑ B col 0)
PE(0,1):  0 + 1√ó6 = 6   ‚Üí  6 + 2√ó8 = 22   ‚úÖ  (= A row 0 ¬∑ B col 1)
PE(1,0):  0 + 3√ó5 = 15  ‚Üí 15 + 4√ó7 = 43   ‚úÖ  (= A row 1 ¬∑ B col 0)
PE(1,1):  0 + 3√ó6 = 18  ‚Üí 18 + 4√ó8 = 50   ‚úÖ  (= A row 1 ¬∑ B col 1)
```

#### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠

- ‡∏ä‡πà‡∏≠‡∏á PE ‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏à‡∏≤‡∏Å **‡πÄ‡∏Ç‡πâ‡∏° ‚Üí ‡∏™‡∏ß‡πà‡∏≤‡∏á** ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏™‡∏°
- ‡∏õ‡πâ‡∏≤‡∏¢ **üü¢ COMPUTING** ‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß Systolic Array
- ‡∏Ñ‡πà‡∏≤ **A:** (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á) ‡πÅ‡∏•‡∏∞ **B:** (‡∏™‡∏µ‡∏ü‡πâ‡∏≤) ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞ PE
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ GEMM ‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà **SRAM[32..47]**

---

### Cycle 9 ‚Äî `ACTIVATE` (ReLU)

- **‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£**: ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `max(0, x)` ‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô SRAM[32..47]
- ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å‡∏´‡∏°‡∏î (19, 22, 43, 50) ‚Üí **‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á**
- ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° **"Negative Values + Sigmoid"** ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤!

---

### Cycle 10 ‚Äî `STORE` (‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏•‡∏±‡∏ö DRAM)

- **‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£**: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å SRAM[32..47] ‚Üí DRAM[48..63]
- **‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï**: ‡∏ä‡πà‡∏≠‡∏á DRAM ‡∏ó‡∏µ‡πà 48‚Äì63 ‡∏à‡∏∞ **highlight ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á** ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:

```
DRAM[48..51] = 19, 22, 0, 0   ‚Üê ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ñ‡∏ß 0
DRAM[52..55] = 43, 50, 0, 0   ‚Üê ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ñ‡∏ß 1
```

---

## ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

| ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô | ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á   | ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                                            |
| :-----: | -------- | ------------------------------------------------- |
|    1    | LOAD     | DRAM ‚Üí SRAM (‡πÇ‡∏´‡∏•‡∏î Matrix A)                       |
|    2    | LOAD     | DRAM ‚Üí SRAM (‡πÇ‡∏´‡∏•‡∏î Matrix B)                       |
|   3‚Äì9   | GEMM     | Systolic Array ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì A√óB ‡πÅ‡∏ö‡∏ö Wavefront (7 cycles) |
|   10    | ACTIVATE | ‡πÉ‡∏ä‡πâ ReLU (‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0)                   |
|   11    | STORE    | SRAM ‚Üí DRAM (‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå)                         |

> ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á NPU ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á:
> **Load weights ‚Üí Compute (Matrix Multiply) ‚Üí Activate ‚Üí Store results**

---

## ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ

### "Identity Matrix Test"

- ‡∏Ñ‡∏π‡∏ì Matrix ‡∏î‡πâ‡∏ß‡∏¢ Identity Matrix ‚Üí ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö Matrix ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
- ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Systolic Array ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### "Negative Values + Sigmoid"

- ‡πÉ‡∏ä‡πâ Matrix ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡πÄ‡∏ä‡πà‡∏ô -2, -3)
- ‡∏´‡∏•‡∏±‡∏á GEMM ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö
- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô **Sigmoid** ‡∏à‡∏∞‡∏ö‡∏µ‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á **0‚Äì1**
- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ 0 ‡∏Ñ‡πà‡∏≤‡∏ö‡∏ß‡∏Å‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ 1
